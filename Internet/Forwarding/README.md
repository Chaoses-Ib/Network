# Forwarding
- Longest prefix matching rule (最长前缀匹配规则)

## Routing table
A **routing table (routing information base, RIB)**, is a data table stored in a router or a network host that lists the routes to particular network destinations, and in some cases, metrics (distances) associated with those routes. The routing table contains information about the topology of the network immediately around it. [^routing-table-wiki]

### Contents
- Destination subnet
- Netmask
- Next hop (Gateway)
- Interface
- Metric
- Quality of service
- Filtering criteria

Q：
- 为什么路由表需要 next hop？有 interface 不就够了吗？
  
  需要 next hop 应该是因为 MAC 协议，需要用 next hop 从 ARP 表得到 MAC 地址。如果是点对点连接，没有 MAC，那只有 interface 就足够了。

[^routing-table-wiki]: [Routing table - Wikipedia](https://en.wikipedia.org/wiki/Routing_table)

## Forwarding table
A **forwarding information base (FIB, forwarding table, MAC table)**, is most commonly used in network bridging, routing, and similar functions to find the proper output network interface controller to which the input interface should forward a packet. [^forwarding-table-wiki]

[^forwarding-table-wiki]: [Forwarding information base - Wikipedia](https://en.wikipedia.org/wiki/Forwarding_information_base)

## 多接口路由
```cmd
> route print
IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          0.0.0.0          0.0.0.0   172.27.255.254      172.27.0.58     35
          0.0.0.0          0.0.0.0  192.168.157.254   192.168.157.18     25
          0.0.0.0        128.0.0.0       198.18.0.2       198.18.0.1      0
         10.0.0.0    255.255.255.0            在链路上          10.0.0.1    291
         10.0.0.1  255.255.255.255            在链路上          10.0.0.1    291
       10.0.0.255  255.255.255.255            在链路上          10.0.0.1    291
        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331
       127.19.0.0      255.255.0.0            在链路上          10.0.0.1     36
   127.19.255.255  255.255.255.255            在链路上          10.0.0.1    291
  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
        128.0.0.0        128.0.0.0       198.18.0.2       198.18.0.1      0
     172.18.192.0    255.255.240.0            在链路上      172.18.192.1   5256
     172.18.192.1  255.255.255.255            在链路上      172.18.192.1   5256
   172.18.207.255  255.255.255.255            在链路上      172.18.192.1   5256
       172.19.0.0      255.255.0.0            在链路上          10.0.0.1     36
       172.19.0.0      255.255.0.0            在链路上      172.18.192.1   5001
   172.19.255.255  255.255.255.255            在链路上          10.0.0.1    291
   172.19.255.255  255.255.255.255            在链路上      172.18.192.1   5256
       172.27.0.0      255.255.0.0            在链路上       172.27.0.58    291
      172.27.0.58  255.255.255.255            在链路上       172.27.0.58    291
   172.27.255.255  255.255.255.255            在链路上       172.27.0.58    291
    192.168.157.0    255.255.255.0            在链路上    192.168.157.18    281
   192.168.157.18  255.255.255.255            在链路上    192.168.157.18    281
  192.168.157.255  255.255.255.255            在链路上    192.168.157.18    281
    192.168.217.0    255.255.255.0            在链路上     192.168.217.1    291
    192.168.217.1  255.255.255.255            在链路上     192.168.217.1    291
  192.168.217.255  255.255.255.255            在链路上     192.168.217.1    291
       198.18.0.0      255.255.0.0            在链路上        198.18.0.1    256
       198.18.0.1  255.255.255.255            在链路上        198.18.0.1    256
   198.18.255.255  255.255.255.255            在链路上        198.18.0.1    256
        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331
        224.0.0.0        240.0.0.0            在链路上          10.0.0.1    291
        224.0.0.0        240.0.0.0            在链路上       172.27.0.58    291
        224.0.0.0        240.0.0.0            在链路上      172.18.192.1   5256
        224.0.0.0        240.0.0.0            在链路上        198.18.0.1    256
        224.0.0.0        240.0.0.0            在链路上     192.168.217.1    291
        224.0.0.0        240.0.0.0            在链路上    192.168.157.18    281
  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
  255.255.255.255  255.255.255.255            在链路上          10.0.0.1    291
  255.255.255.255  255.255.255.255            在链路上       172.27.0.58    291
  255.255.255.255  255.255.255.255            在链路上      172.18.192.1   5256
  255.255.255.255  255.255.255.255            在链路上        198.18.0.1    256
  255.255.255.255  255.255.255.255            在链路上     192.168.217.1    291
  255.255.255.255  255.255.255.255            在链路上    192.168.157.18    281
===========================================================================
永久路由:
  无
```
跃点越小优先级越高。
```cmd
route delete 0.0.0.0 mask 0.0.0.0 192.168.157.254
route add 192.168.0.0 mask 255.255.0.0 192.168.157.254
```

## Linux
- `ip route`
- `route -n`
